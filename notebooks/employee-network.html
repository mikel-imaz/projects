
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Employee Network Analysis &#8212; datuz</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-232XT3FYCT"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-232XT3FYCT');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-232XT3FYCT');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/employee-network';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../_static/logo.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reducing hospital readmissions" href="hospital.html" />
    <link rel="prev" title="Hairloss Analysis" href="hairloss.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="datuz - Home"/>
    <img src="../_static/logo.svg" class="logo__image only-dark pst-js-only" alt="datuz - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Data science projects
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../projects_competition.html">Competition projects</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="machine-downtime.html">Predicting Industrial Machine Downtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="book-popularity.html">What makes a good book?</a></li>
<li class="toctree-l2"><a class="reference internal" href="internet-patterns.html">Analyzing global internet patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="sleepinc.html">Helping find a better sleep</a></li>
<li class="toctree-l2"><a class="reference internal" href="hairloss.html">Hairloss Analysis</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Employee Network Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="hospital.html">Reducing hospital readmissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="hotels.html">Predicting hotel cancellations</a></li>
<li class="toctree-l2"><a class="reference internal" href="webpage.html">Was a website redesign successful?</a></li>
<li class="toctree-l2"><a class="reference internal" href="segmentation.html">Improving customer segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="abalone.html">Seafood farm process improvement</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../projects_personal.html">Personal projects</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="chm.html">Canopy Height Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="moles.html">Mole monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="book-translation.html">Book translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="p-antio-gpt.html">Sentiment analysis with embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="self-tracking.html">Self tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="quakes.html">Earth Quakes</a></li>
<li class="toctree-l2"><a class="reference internal" href="climate.html">Climate Change</a></li>
<li class="toctree-l2"><a class="reference internal" href="english-vocab.html">English Vocab</a></li>
<li class="toctree-l2"><a class="reference internal" href="antio.html">Bar Reviews</a></li>
<li class="toctree-l2"><a class="reference internal" href="ignatian.html">Ignatian Pilgrims</a></li>
<li class="toctree-l2"><a class="reference internal" href="p-udalmap.html">Municipal Indicators</a></li>
<li class="toctree-l2"><a class="reference internal" href="p-films.html">Movie records</a></li>
<li class="toctree-l2"><a class="reference internal" href="ages.html">Median Ages</a></li>
<li class="toctree-l2"><a class="reference internal" href="water.html">Water Supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="olele.html">Handfan Reviews</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_fines.html">Traffic Fines</a></li>
<li class="toctree-l2"><a class="reference internal" href="urban_trees.html">Urban Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="breads.html">Bread Prices</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../writings.html">Writings</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../writings/la-importancia-de-adquirir-competencias-en-materia-de-datos.html">La importancia de adquirir competencias en materia de datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/la-ciencia-de-convertir-los-datos-en-valor.html">La ciencia de convertir los datos en valor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/que-es-la-inteligencia-artificial.html">¿Qué es la Inteligencia Artificial?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/aprendizaje-autom%C3%A1tico-vs-programaci%C3%B3n-tradicional.html">Aprendizaje automático vs programación tradicional</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/que-es-la-inteligencia-artificial-generativa.html">¿Qué es la Inteligencia Artificial Generativa?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/la-definicion-de-atributos-en-aprendizaje-automatico.html">La definición de atributos en aprendizaje automático</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/por-que-python.html">¿Por qué Python?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/estadistica-computacional-la-estadistica-sin-dolor.html">Estadística computacional: la estadística sin dolor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/como-funciona-el-aprendizaje-profundo.html">¿Cómo funciona el aprendizaje profundo?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/ia-predictiva-vs-ia-generativa.html">IA predictiva vs IA generativa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/etica-en-la-ia.html">Ética en la IA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/las-3-capas-de-un-proyecto-de-datos.html">Las 3 capas de un proyecto de datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/ia-aplicada-la-empresa-empoderada-por-la-ia.html">IA aplicada: la empresa empoderada por la IA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/llm-modo-de-empleo.html">LLM: modo de empleo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/ley-de-ia-de-la-ue.html">Ley de IA de la UE</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../about-me.html">About me</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/mikel-imaz/projects" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/employee-network.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Employee Network Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-project">The project</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#company">Company</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#messages">Messages</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#between-departments">Between departments</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#between-locations">Between locations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#departments-in-locations">Departments in locations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#employee-network">Employee network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="employee-network-analysis">
<h1>Employee Network Analysis<a class="headerlink" href="#employee-network-analysis" title="Link to this heading">#</a></h1>
<p><img alt="" src="../_images/employee-network-analysis.jpg" /></p>
<p><em>A <a class="reference external" href="https://datacamp.com">DataCamp</a> challenge</em>     <svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-calendar" viewBox="0 0 16 16" aria-hidden="true"><path d="M4.75 0a.75.75 0 0 1 .75.75V2h5V.75a.75.75 0 0 1 1.5 0V2h1.25c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 13.25 16H2.75A1.75 1.75 0 0 1 1 14.25V3.75C1 2.784 1.784 2 2.75 2H4V.75A.75.75 0 0 1 4.75 0ZM2.5 7.5v6.75c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25V7.5Zm10.75-4H2.75a.25.25 0 0 0-.25.25V6h11V3.75a.25.25 0 0 0-.25-.25Z"></path></svg> Mar, 2024</p>
<p><span class="sd-sphinx-override sd-badge sd-outline-primary sd-text-primary">Network analysis</span></p>
<section id="the-project">
<h2>The project<a class="headerlink" href="#the-project" title="Link to this heading">#</a></h2>
<p>You work in the analytics department of a multinational company, and the head of HR wants your help mapping out the company’s employee network using message data.</p>
<p>They plan to use the network map to understand interdepartmental dynamics better and explore how the company shares information. The ultimate goal of this project is to think of ways to improve collaboration throughout the company.</p>
<p>Create a report that covers the following:</p>
<ol class="arabic simple">
<li><p>Which departments are the most/least active?</p></li>
<li><p>Which employee has the most connections?</p></li>
<li><p>Identify the most influential departments and employees.</p></li>
<li><p>Using the network analysis, in which departments would you recommend the HR team focus to boost collaboration?</p></li>
</ol>
</section>
<section id="the-data">
<h2>The data<a class="headerlink" href="#the-data" title="Link to this heading">#</a></h2>
<p>The company has six months of information on inter-employee communication. For privacy reasons, only sender, receiver, and message length information are available <a class="reference external" href="https://snap.stanford.edu/data/CollegeMsg.html">(source)</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Messages</span></code> has information on the sender, receiver, and time.</p>
<ul class="simple">
<li><p>“sender” - represents the employee id of the employee sending the message.</p></li>
<li><p>“receiver” - represents the employee id of the employee receiving the message.</p></li>
<li><p>“timestamp” - the date of the message.</p></li>
<li><p>“message_length” - the length in words of the message.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Employees</span></code> has information on each employee.</p>
<ul class="simple">
<li><p>“id” - represents the employee id of the employee.</p></li>
<li><p>“department” - is the department within the company.</p></li>
<li><p>“location” - is the country where the employee lives.</p></li>
<li><p>“age” - is the age of the employee.</p></li>
</ul>
<p><em><strong>Acknowledgments:</strong> Pietro Panzarasa, Tore Opsahl, and Kathleen M. Carley. “Patterns and dynamics of users’ behavior and interaction: Network analysis of an online community.” Journal of the American Society for Information Science and Technology 60.5 (2009): 911-932.</em></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>

<span class="n">messages</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/messages.csv&quot;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span>
<span class="n">messages</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sender</th>
      <th>receiver</th>
      <th>timestamp</th>
      <th>message_length</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>79</td>
      <td>48</td>
      <td>2021-06-02 05:41:34</td>
      <td>88</td>
    </tr>
    <tr>
      <th>1</th>
      <td>79</td>
      <td>63</td>
      <td>2021-06-02 05:42:15</td>
      <td>72</td>
    </tr>
    <tr>
      <th>2</th>
      <td>79</td>
      <td>58</td>
      <td>2021-06-02 05:44:24</td>
      <td>86</td>
    </tr>
    <tr>
      <th>3</th>
      <td>79</td>
      <td>70</td>
      <td>2021-06-02 05:49:07</td>
      <td>26</td>
    </tr>
    <tr>
      <th>4</th>
      <td>79</td>
      <td>109</td>
      <td>2021-06-02 19:51:47</td>
      <td>73</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3507</th>
      <td>469</td>
      <td>1629</td>
      <td>2021-11-24 05:04:57</td>
      <td>75</td>
    </tr>
    <tr>
      <th>3508</th>
      <td>1487</td>
      <td>1543</td>
      <td>2021-11-26 00:39:43</td>
      <td>25</td>
    </tr>
    <tr>
      <th>3509</th>
      <td>144</td>
      <td>1713</td>
      <td>2021-11-28 18:30:47</td>
      <td>51</td>
    </tr>
    <tr>
      <th>3510</th>
      <td>1879</td>
      <td>1520</td>
      <td>2021-11-29 07:27:52</td>
      <td>58</td>
    </tr>
    <tr>
      <th>3511</th>
      <td>1879</td>
      <td>1543</td>
      <td>2021-11-29 07:37:49</td>
      <td>56</td>
    </tr>
  </tbody>
</table>
<p>3512 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employees</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/employees.csv&quot;</span><span class="p">)</span>
<span class="n">employees</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>department</th>
      <th>location</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>Operations</td>
      <td>US</td>
      <td>33</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6</td>
      <td>Sales</td>
      <td>UK</td>
      <td>50</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
      <td>IT</td>
      <td>Brasil</td>
      <td>54</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9</td>
      <td>Admin</td>
      <td>UK</td>
      <td>32</td>
    </tr>
    <tr>
      <th>4</th>
      <td>12</td>
      <td>Operations</td>
      <td>Brasil</td>
      <td>51</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>659</th>
      <td>1830</td>
      <td>Admin</td>
      <td>UK</td>
      <td>42</td>
    </tr>
    <tr>
      <th>660</th>
      <td>1839</td>
      <td>Admin</td>
      <td>France</td>
      <td>28</td>
    </tr>
    <tr>
      <th>661</th>
      <td>1879</td>
      <td>Engineering</td>
      <td>US</td>
      <td>40</td>
    </tr>
    <tr>
      <th>662</th>
      <td>1881</td>
      <td>Sales</td>
      <td>Germany</td>
      <td>57</td>
    </tr>
    <tr>
      <th>663</th>
      <td>1890</td>
      <td>Admin</td>
      <td>US</td>
      <td>39</td>
    </tr>
  </tbody>
</table>
<p>664 rows × 4 columns</p>
</div></div></div>
</div>
</section>
<section id="company">
<h2>Company<a class="headerlink" href="#company" title="Link to this heading">#</a></h2>
<p>The following graph shows the distribution, by location and by departments, of the 664 employees of the company.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group employees by location and count them by department</span>
<span class="n">employees_loc_dep</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;department&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;count&quot;</span>
<span class="p">)</span>

<span class="c1"># Calculate total employees by location</span>
<span class="n">employees_loc_dep</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">employees_loc_dep</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Sort values</span>
<span class="n">employees_loc_dep</span> <span class="o">=</span> <span class="n">employees_loc_dep</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;total&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># employees_loc_dep</span>

<span class="c1"># Define color palette</span>
<span class="n">palette</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span> <span class="s2">&quot;goldenrod&quot;</span><span class="p">,</span> <span class="s2">&quot;tomato&quot;</span><span class="p">,</span> <span class="s2">&quot;navy&quot;</span><span class="p">,</span> <span class="s2">&quot;violet&quot;</span><span class="p">,</span> <span class="s2">&quot;steelblue&quot;</span><span class="p">]</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">employees_loc_dep</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;total&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">palette</span>
<span class="p">)</span>
<span class="n">legend_h</span><span class="p">,</span> <span class="n">legend_l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>  <span class="c1"># I will use it later</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of employees&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/4c291f8fdd2a0db42a3a97b4d554187f14a26aa7044baaeecedf2cd2c38bd64f.png" src="../_images/4c291f8fdd2a0db42a3a97b4d554187f14a26aa7044baaeecedf2cd2c38bd64f.png" />
</div>
</div>
</section>
<section id="messages">
<h2>Messages<a class="headerlink" href="#messages" title="Link to this heading">#</a></h2>
<section id="between-departments">
<h3>Between departments<a class="headerlink" href="#between-departments" title="Link to this heading">#</a></h3>
<p>These are the number of messages sent between departments. The size of the nodes represents the number of employees that each department has.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge messages-employees dataframes on sender ids</span>
<span class="n">senders</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">employees</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;sender&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
    <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># Rename columns</span>
<span class="n">senders</span> <span class="o">=</span> <span class="n">senders</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;department&quot;</span><span class="p">:</span> <span class="s2">&quot;s_dep&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;s_loc&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="s2">&quot;s_age&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Merge messages-employees dataframes on receiver ids</span>
<span class="n">senders_receivers</span> <span class="o">=</span> <span class="n">senders</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">employees</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;receiver&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Rename columns</span>
<span class="n">senders_receivers</span> <span class="o">=</span> <span class="n">senders_receivers</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;department&quot;</span><span class="p">:</span> <span class="s2">&quot;r_dep&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;r_loc&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="s2">&quot;r_age&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># senders_receivers.head()</span>

<span class="c1"># Pivot table on sender-receiver departments to count messages sent</span>
<span class="n">dep_table</span> <span class="o">=</span> <span class="n">senders_receivers</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">&quot;s_dep&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;r_dep&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;sender&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;count&quot;</span>
<span class="p">)</span>

<span class="c1"># Create a directional graph</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>

<span class="c1"># Add nodes: the set of departments</span>
<span class="n">D</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">dep_table</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># Add edges</span>
<span class="n">dep_edges</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dep_msgs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dep_table</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dep_table</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">msgs</span> <span class="o">=</span> <span class="n">dep_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msgs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dep_edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dep_table</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dep_table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">dep_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>  <span class="c1"># Store them to add metadata later</span>

<span class="n">D</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">dep_edges</span><span class="p">)</span>

<span class="c1"># Add metadata (number of messages) for each edge</span>
<span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">dep_msgs</span><span class="p">):</span>
    <span class="n">D</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># D.edges(data=True) # Print edges with metadata</span>

<span class="c1"># Node colors</span>
<span class="n">color_key</span> <span class="o">=</span> <span class="p">{</span><span class="n">department</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">department</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dep_table</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">palette</span><span class="p">)}</span>
<span class="n">node_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_key</span><span class="p">[</span><span class="n">dept</span><span class="p">]</span> <span class="k">for</span> <span class="n">dept</span> <span class="ow">in</span> <span class="n">D</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>

<span class="c1"># Node size according to number of employees by department</span>
<span class="n">department_employees</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;department&quot;</span><span class="p">)[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">900</span>  <span class="c1"># Just to match desired size in the plot</span>
<span class="n">dep_node_sizes</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">department_employees</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="n">department_employees</span><span class="p">)</span>

<span class="c1"># Linewidth of the edges according to number of messages</span>
<span class="n">dep_msgs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dep_msgs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">])</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]</span>
<span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">widths</span><span class="p">)</span>
<span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;dep_edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dep_edges</span>
<span class="n">linewidth_edges</span> <span class="o">=</span> <span class="n">dep_msgs_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;dep_edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="nb">list</span>
<span class="p">)</span>

<span class="c1"># Layout of the graph</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">dep_node_sizes</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">node_colors</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span>
    <span class="n">D</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">font_weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">edgelist</span> <span class="ow">in</span> <span class="n">linewidth_edges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span>
        <span class="n">D</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">arrows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
        <span class="n">node_size</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">dep_node_sizes</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span>
    <span class="n">D</span><span class="p">,</span>
    <span class="n">pos</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">edge_labels</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">),</span>
    <span class="n">label_pos</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">font_size</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/f9c52716dca08acc1d9c8a66642c4c33db7c1e6139b43010c1502549563adb3e.png" src="../_images/f9c52716dca08acc1d9c8a66642c4c33db7c1e6139b43010c1502549563adb3e.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Count number of employees per department</span>
<span class="n">n_employees_dep</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">&quot;department&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;count&quot;</span>
<span class="p">)</span>

<span class="c1"># Create table with messages per employee</span>
<span class="n">dep_table_rel</span> <span class="o">=</span> <span class="n">dep_table</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">n_employees_dep</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Divide by row</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">dep_table</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">},</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.0f&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">dep_table_rel</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">},</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.1f&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;RECEIVER&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;SENDER&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Number of messages&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Messages per employee&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/ee866d12a8592a829c424250e6aa69d6dd2a0119dd4de72a8f54b4004e999d4f.png" src="../_images/ee866d12a8592a829c424250e6aa69d6dd2a0119dd4de72a8f54b4004e999d4f.png" />
</div>
</div>
<p>In the following graph, the size of the nodes represents the number of messages sent by each employee in that department, which is the number displayed in the node. The thickness of the connections is proportional to that quantity.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a directional graph</span>
<span class="n">D_rel</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>

<span class="c1"># Add nodes: the set of departments</span>
<span class="n">D_rel</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">dep_table_rel</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># Add edges</span>
<span class="n">dep_edges</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dep_msgs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dep_table_rel</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dep_table_rel</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">msgs</span> <span class="o">=</span> <span class="n">dep_table_rel</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msgs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dep_edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dep_table_rel</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dep_table_rel</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">dep_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>  <span class="c1"># Store them to add metadata later</span>

<span class="n">D_rel</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">dep_edges</span><span class="p">)</span>

<span class="c1"># Add metadata (number of messages) for each edge</span>
<span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">D_rel</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">dep_msgs</span><span class="p">):</span>
    <span class="n">D_rel</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># D.edges(data=True) # Print edges with metadata</span>

<span class="c1"># Node colors</span>
<span class="n">color_key</span> <span class="o">=</span> <span class="p">{</span><span class="n">department</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">department</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dep_table</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">palette</span><span class="p">)}</span>
<span class="n">node_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_key</span><span class="p">[</span><span class="n">dept</span><span class="p">]</span> <span class="k">for</span> <span class="n">dept</span> <span class="ow">in</span> <span class="n">D_rel</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>

<span class="c1"># Node size according to number of messages sent by department</span>
<span class="n">sent_per_employee</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">dep_table_rel</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># Just to match desired size in the plot</span>
<span class="n">dep_node_sizes</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">sent_per_employee</span>

<span class="c1"># Labels</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">sent</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">D_rel</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">sent_per_employee</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Linewidth of the edges according to number of messages</span>
<span class="n">dep_msgs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dep_msgs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">])</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">]</span>
<span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">widths</span><span class="p">)</span>
<span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;dep_edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dep_edges</span>
<span class="n">linewidth_edges</span> <span class="o">=</span> <span class="n">dep_msgs_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;dep_edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="nb">list</span>
<span class="p">)</span>

<span class="c1"># Layout of the graph</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spiral_layout</span><span class="p">(</span><span class="n">D_rel</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span>
    <span class="n">D_rel</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">dep_node_sizes</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">node_colors</span>
<span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span>
    <span class="n">D_rel</span><span class="p">,</span>
    <span class="n">pos</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">font_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">font_weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">edgelist</span> <span class="ow">in</span> <span class="n">linewidth_edges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span>
        <span class="n">D_rel</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
        <span class="n">node_size</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">dep_node_sizes</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_h</span><span class="p">,</span> <span class="n">legend_l</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/6fceac0532662ef9e958361e54679ef0d105190a2d453433047197d91d765086.png" src="../_images/6fceac0532662ef9e958361e54679ef0d105190a2d453433047197d91d765086.png" />
</div>
</div>
<p>The graph clearly shows that the majority of the traffic is generated by the triangle formed by the Sales, Admin, and Operations. Employees working in these departments send an average of more than six messages, while others do not reach even one message per employee.</p>
<p>The metric called <em>Degree Centrality</em> is a measure of the number of neighbors a node has, divided by the total number it could possibly have.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Degree centrality: Number of nbrs vs number of nbrs I could possibly have</span>
<span class="n">degree_centrality_D</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">degree_centrality</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

<span class="c1"># Sort</span>
<span class="n">degree_centrality_D_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
    <span class="n">degree_centrality_D</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># List most important nodes-employees by degree centrality</span>
<span class="n">degree_centrality_D_sorted</span>  <span class="c1"># = degree_centrality_D_sorted / max(degree_centrality_D_sorted)</span>

<span class="c1"># Print normalized values</span>
<span class="n">_</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="n">degree_centrality_D_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degree centrality:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">dep</span><span class="p">,</span> <span class="n">dc</span> <span class="ow">in</span> <span class="n">degree_centrality_D_sorted</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dep</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">dc</span><span class="o">/</span><span class="nb">max</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Degree centrality:

Admin --&gt; 1.0
Operations --&gt; 1.0
Sales --&gt; 1.0
Engineering --&gt; 0.9
IT --&gt; 0.9
Marketing --&gt; 0.7
</pre></div>
</div>
</div>
</div>
<p>These data indicate what we had already seen in the previous tables: while Admin Operations and Sales send to and receive from all departments, the rest lack some form of communication. Engineering is not sending to Marketing and IT is not receiving from Marketing. Marketing are not sending to IT and they do not send messages to themselves.</p>
</section>
<section id="between-locations">
<h3>Between locations<a class="headerlink" href="#between-locations" title="Link to this heading">#</a></h3>
<p>These are the number of messages sent between locations. The size of the nodes represents the number of employees that each location has.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pivot table on sender-receiver locations to count messages sent</span>
<span class="n">loc_table</span> <span class="o">=</span> <span class="n">senders_receivers</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">&quot;s_loc&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;r_loc&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;sender&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;count&quot;</span>
<span class="p">)</span>

<span class="c1"># Create a directional graph</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>

<span class="c1"># Add nodes: the set of locations</span>
<span class="n">C</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">loc_table</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># Add edges</span>
<span class="n">loc_edges</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">loc_msgs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loc_table</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loc_table</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">msgs</span> <span class="o">=</span> <span class="n">loc_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msgs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">loc_edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">loc_table</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">loc_table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">loc_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>  <span class="c1"># Store them to add metadata later</span>

<span class="n">C</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">loc_edges</span><span class="p">)</span>

<span class="c1"># Add metadata (number of messages) for each edge</span>
<span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">loc_msgs</span><span class="p">):</span>
    <span class="n">C</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Node size according to number of employees by location</span>
<span class="n">location_employees</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">400</span>  <span class="c1"># Just to match desired size in the plot</span>
<span class="n">loc_node_sizes</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">location_employees</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="n">location_employees</span><span class="p">)</span>

<span class="c1"># Linewidth of the edges according to number of messages</span>
<span class="n">loc_msgs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">loc_msgs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">])</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]</span>
<span class="n">loc_msgs_df</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">loc_msgs_df</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">widths</span><span class="p">)</span>
<span class="n">loc_msgs_df</span><span class="p">[</span><span class="s2">&quot;loc_edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_edges</span>
<span class="n">linewidth_edges</span> <span class="o">=</span> <span class="n">loc_msgs_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;loc_edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="nb">list</span>
<span class="p">)</span>

<span class="c1"># Layout of the graph</span>
<span class="c1"># Adjust manually country positions for readibility</span>
<span class="n">location_key</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Brasil&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">6000000</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000000</span><span class="p">),</span>
    <span class="c1"># &quot;Brasil&quot;: (-4810350.913, -2620812.957),</span>
    <span class="s2">&quot;France&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1500000</span><span class="p">,</span> <span class="mi">5000000</span><span class="p">),</span>
    <span class="c1"># &quot;France&quot;: (261933.923, 6250816.842),</span>
    <span class="s2">&quot;Germany&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2000000</span><span class="p">,</span> <span class="mi">8500000</span><span class="p">),</span>
    <span class="c1"># &quot;Germany&quot;: (1491636.961, 6895388.529),</span>
    <span class="s2">&quot;UK&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1700000</span><span class="p">,</span> <span class="mi">8000000</span><span class="p">),</span>
    <span class="c1"># &quot;UK&quot;: (-13210.028, 6710566.113),</span>
    <span class="s2">&quot;US&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">9000000</span><span class="p">,</span> <span class="mi">4000000</span><span class="p">),</span>
    <span class="c1"># &quot;US&quot;: (-8237165.598, 4971358.429),</span>
<span class="p">}</span>
<span class="n">pos</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">location_key</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">C</span><span class="o">.</span><span class="n">nodes</span><span class="p">()}</span>

<span class="c1"># Labels</span>
<span class="n">label_key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Brasil&quot;</span><span class="p">:</span> <span class="s2">&quot;BR&quot;</span><span class="p">,</span> <span class="s2">&quot;France&quot;</span><span class="p">:</span> <span class="s2">&quot;FR&quot;</span><span class="p">,</span> <span class="s2">&quot;Germany&quot;</span><span class="p">:</span> <span class="s2">&quot;GR&quot;</span><span class="p">,</span> <span class="s2">&quot;UK&quot;</span><span class="p">:</span> <span class="s2">&quot;UK&quot;</span><span class="p">,</span> <span class="s2">&quot;US&quot;</span><span class="p">:</span> <span class="s2">&quot;US&quot;</span><span class="p">}</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">label_key</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">C</span><span class="o">.</span><span class="n">nodes</span><span class="p">()}</span>

<span class="c1"># Prepare world map background from GeoPandas in projection 3857</span>
<span class="c1"># naturalearth_lowres = gpd.read_file(gpd.datasets.get_path(&quot;naturalearth_lowres&quot;)) # &lt;- deprecated</span>
<span class="n">naturalearth_lowres</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;map/ne_110m_admin_0_countries.shp&quot;</span><span class="p">)</span>
<span class="n">naturalearth_lowres_3857</span> <span class="o">=</span> <span class="n">naturalearth_lowres</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">naturalearth_lowres_3857</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">naturalearth_lowres_3857</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">naturalearth_lowres_3857</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5e7</span><span class="p">,</span> <span class="mf">0.5e7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5e7</span><span class="p">,</span> <span class="mf">1e7</span><span class="p">)</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">loc_node_sizes</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span>
    <span class="n">C</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">font_weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">edgelist</span> <span class="ow">in</span> <span class="n">linewidth_edges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span>
        <span class="n">C</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">arrows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
        <span class="n">node_size</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">loc_node_sizes</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span>
    <span class="n">C</span><span class="p">,</span>
    <span class="n">pos</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">edge_labels</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">),</span>
    <span class="n">label_pos</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">font_size</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">rotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/d37079cca813feb2bc48319eb337b38d7484c812e81c3e511bad18eb809782b8.png" src="../_images/d37079cca813feb2bc48319eb337b38d7484c812e81c3e511bad18eb809782b8.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Count number of employees per location</span>
<span class="n">n_employees_loc</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>

<span class="c1"># Create table with messages per employee</span>
<span class="n">loc_table_rel</span> <span class="o">=</span> <span class="n">loc_table</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">n_employees_loc</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Divide by row</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">loc_table</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">},</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.0f&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">loc_table_rel</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">},</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.1f&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;RECEIVER&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;SENDER&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Number of messages&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Messages per employee&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/8ee04439852ee5fdc3986bf7f3aa3b68c83af1b989146afee512ec2006d563cb.png" src="../_images/8ee04439852ee5fdc3986bf7f3aa3b68c83af1b989146afee512ec2006d563cb.png" />
</div>
</div>
<p>In the following graph, the size of the nodes represents the number of messages sent by employee in each location, which is the number displayed in the node. The thickness of the connections is proportional to that quantity.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a directional graph</span>
<span class="n">C_rel</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>

<span class="c1"># Add nodes: the set of departments</span>
<span class="n">C_rel</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">loc_table_rel</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># Add edges</span>
<span class="n">dep_edges</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dep_msgs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loc_table_rel</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loc_table_rel</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">msgs</span> <span class="o">=</span> <span class="n">loc_table_rel</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msgs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dep_edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">loc_table_rel</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">loc_table_rel</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">dep_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>  <span class="c1"># Store them to add metadata later</span>

<span class="n">C_rel</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">dep_edges</span><span class="p">)</span>

<span class="c1"># Add metadata (number of messages) for each edge</span>
<span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">C_rel</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">dep_msgs</span><span class="p">):</span>
    <span class="n">C_rel</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>


<span class="c1"># Node size according to number of messages sent by department</span>
<span class="n">sent_per_employee</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">loc_table_rel</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># Just to match desired size in the plot</span>
<span class="n">dep_node_sizes</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">sent_per_employee</span>

<span class="c1"># Labels</span>
<span class="n">label_key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Brasil&quot;</span><span class="p">:</span> <span class="s2">&quot;BR&quot;</span><span class="p">,</span> <span class="s2">&quot;France&quot;</span><span class="p">:</span> <span class="s2">&quot;FR&quot;</span><span class="p">,</span> <span class="s2">&quot;Germany&quot;</span><span class="p">:</span> <span class="s2">&quot;GR&quot;</span><span class="p">,</span> <span class="s2">&quot;UK&quot;</span><span class="p">:</span> <span class="s2">&quot;UK&quot;</span><span class="p">,</span> <span class="s2">&quot;US&quot;</span><span class="p">:</span> <span class="s2">&quot;US&quot;</span><span class="p">}</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">n</span><span class="p">:</span> <span class="n">label_key</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">sent</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">C_rel</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">sent_per_employee</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Linewidth of the edges according to number of messages</span>
<span class="n">dep_msgs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dep_msgs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">])</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">]</span>
<span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">widths</span><span class="p">)</span>
<span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;dep_edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dep_edges</span>
<span class="n">linewidth_edges</span> <span class="o">=</span> <span class="n">dep_msgs_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;dep_edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="nb">list</span>
<span class="p">)</span>

<span class="c1"># Layout of the graph</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shell_layout</span><span class="p">(</span><span class="n">C_rel</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">C_rel</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">dep_node_sizes</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span>
    <span class="n">C_rel</span><span class="p">,</span>
    <span class="n">pos</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">font_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">font_weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">edgelist</span> <span class="ow">in</span> <span class="n">linewidth_edges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span>
        <span class="n">C_rel</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
        <span class="n">node_size</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">dep_node_sizes</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/ab293e505a45b796986543bc425239f523ab5118f157264e41a3224138e968f4.png" src="../_images/ab293e505a45b796986543bc425239f523ab5118f157264e41a3224138e968f4.png" />
</div>
</div>
<p>The predominance of France is clearly evident, with nearly 10 messages per employee, most of them directed towards the US, which comes second. Following are Germany, Brazil, and lastly the UK, which doesn’t even reach one email sent per employee.</p>
<p>Nevertheless, all countries have communicated with each other according to the values of Degree Centrality.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Degree centrality: Number of nbrs vs number of nbrs I could possibly have</span>
<span class="n">degree_centrality_C</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">degree_centrality</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

<span class="c1"># Sort</span>
<span class="n">degree_centrality_C_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
    <span class="n">degree_centrality_C</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># List most important nodes-employees by degree centrality</span>
<span class="n">degree_centrality_C_sorted</span>

<span class="c1"># Print normalized values</span>
<span class="n">_</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="n">degree_centrality_D_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degree centrality:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">dc</span> <span class="ow">in</span> <span class="n">degree_centrality_C_sorted</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">loc</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">dc</span><span class="o">/</span><span class="nb">max</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Degree centrality:

Brasil --&gt; 1.0
France --&gt; 1.0
Germany --&gt; 1.0
UK --&gt; 1.0
US --&gt; 1.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="departments-in-locations">
<h3>Departments in locations<a class="headerlink" href="#departments-in-locations" title="Link to this heading">#</a></h3>
<p>Let’s consider messages sent by each department in each location. The size of the nodes represents the number of employees that each department has at that particular location.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pivot table on sender-receiver departments and locations to count messages sent</span>
<span class="n">msg_table</span> <span class="o">=</span> <span class="n">senders_receivers</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;s_loc&quot;</span><span class="p">,</span> <span class="s2">&quot;s_dep&quot;</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;r_loc&quot;</span><span class="p">,</span> <span class="s2">&quot;r_dep&quot;</span><span class="p">],</span>
    <span class="n">values</span><span class="o">=</span><span class="s2">&quot;sender&quot;</span><span class="p">,</span>
    <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create a directional graph</span>
<span class="n">DC</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>

<span class="c1"># Add nodes: the set of departments</span>
<span class="n">DC</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">msg_table</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># Add edges</span>
<span class="n">deploc_edges</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">deploc_msgs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg_table</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg_table</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">msgs</span> <span class="o">=</span> <span class="n">msg_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msgs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">deploc_edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">msg_table</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">msg_table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">deploc_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>

<span class="n">DC</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">deploc_edges</span><span class="p">)</span>

<span class="c1"># Add metadata (number of messages) for each edge</span>
<span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">deploc_msgs</span><span class="p">):</span>
    <span class="n">DC</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Plotting to a polygon background</span>

<span class="n">node_color</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">nodes</span><span class="p">())):</span>
    <span class="n">node_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color_key</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">nodes</span><span class="p">())[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>

<span class="c1"># Node size according to number of employees by department</span>
<span class="n">location_department_employees</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;department&quot;</span><span class="p">])[</span>
    <span class="s2">&quot;id&quot;</span>
<span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">node_sizes</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">location_department_employees</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="n">location_department_employees</span><span class="p">)</span>


<span class="c1"># Linewidth of the edges according to number of messages</span>
<span class="n">deploc_msgs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">deploc_msgs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">])</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]</span>
<span class="n">deploc_msgs_df</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">deploc_msgs_df</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">widths</span><span class="p">)</span>
<span class="n">deploc_msgs_df</span><span class="p">[</span><span class="s2">&quot;deploc_edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">deploc_edges</span>
<span class="n">linewidth_edges</span> <span class="o">=</span> <span class="n">deploc_msgs_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span>
    <span class="s2">&quot;deploc_edges&quot;</span>
<span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>


<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>

<span class="n">label_key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Brasil&quot;</span><span class="p">:</span> <span class="s2">&quot;BR&quot;</span><span class="p">,</span> <span class="s2">&quot;France&quot;</span><span class="p">:</span> <span class="s2">&quot;FR&quot;</span><span class="p">,</span> <span class="s2">&quot;Germany&quot;</span><span class="p">:</span> <span class="s2">&quot;GR&quot;</span><span class="p">,</span> <span class="s2">&quot;UK&quot;</span><span class="p">:</span> <span class="s2">&quot;UK&quot;</span><span class="p">,</span> <span class="s2">&quot;US&quot;</span><span class="p">:</span> <span class="s2">&quot;US&quot;</span><span class="p">}</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">n</span><span class="p">:</span> <span class="n">label_key</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">nodes</span><span class="p">())[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">nodes</span><span class="p">()))))</span>
<span class="p">}</span>


<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">DC</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">node_sizes</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">node_color</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span>
    <span class="n">DC</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">font_weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">edgelist</span> <span class="ow">in</span> <span class="n">linewidth_edges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span>
        <span class="n">DC</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">arrows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
        <span class="n">node_size</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">node_sizes</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_h</span><span class="p">,</span> <span class="n">legend_l</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/2a60de3b194fd599c4b162277522de693e1d065e0632ea72d0bffcb31cba16be.png" src="../_images/2a60de3b194fd599c4b162277522de693e1d065e0632ea72d0bffcb31cba16be.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of employees per location and department</span>
<span class="n">n_employees_loc_dep</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;department&quot;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;count&quot;</span>
<span class="p">)</span>

<span class="c1"># Reindex the table because some entities had no sent messages and do no appear</span>
<span class="n">msg_table</span> <span class="o">=</span> <span class="n">msg_table</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">n_employees_loc_dep</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># Create table with messages per employee</span>
<span class="n">msg_table_rel</span> <span class="o">=</span> <span class="n">msg_table</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">n_employees_loc_dep</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Divide by row</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">18.25</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">msg_table</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">},</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.0f&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">msg_table_rel</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">},</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.1f&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;SENDER&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;RECEIVER&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Number of messages&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Messages per employee&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/e340954391e446ab34245906ef962ee5791926fd7f8f7b01d8b9031dc17ec6f1.png" src="../_images/e340954391e446ab34245906ef962ee5791926fd7f8f7b01d8b9031dc17ec6f1.png" />
</div>
</div>
<p>In the following graph, the size of the nodes represents the number of messages sent by employee in each department and location, which is the number displayed in the node. The thickness of the connections is proportional to that quantity.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a directional graph</span>
<span class="n">DC_rel</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>

<span class="c1"># Add nodes: the set of departments</span>
<span class="n">DC_rel</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">msg_table_rel</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># Add edges</span>
<span class="n">dep_edges</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dep_msgs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg_table_rel</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg_table_rel</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">msgs</span> <span class="o">=</span> <span class="n">msg_table_rel</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msgs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dep_edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">msg_table_rel</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">msg_table_rel</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">dep_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>  <span class="c1"># Store them to add metadata later</span>

<span class="n">DC_rel</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">dep_edges</span><span class="p">)</span>

<span class="c1"># Add metadata (number of messages) for each edge</span>
<span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">DC_rel</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">dep_msgs</span><span class="p">):</span>
    <span class="n">DC_rel</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Node colors</span>
<span class="n">color_key</span> <span class="o">=</span> <span class="p">{</span><span class="n">department</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">department</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dep_table</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">palette</span><span class="p">)}</span>
<span class="n">node_colors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">DC_rel</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
    <span class="n">node_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color_key</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="c1"># node_colors.append(color_key[list(DC_rel.nodes())[n][1]])</span>

<span class="c1"># Node size according to number of messages sent by department</span>
<span class="n">sent_per_employee</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">msg_table_rel</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># Just to match desired size in the plot</span>
<span class="n">dep_node_sizes</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">sent_per_employee</span>

<span class="c1"># Labels</span>
<span class="n">label_key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Brasil&quot;</span><span class="p">:</span> <span class="s2">&quot;BR&quot;</span><span class="p">,</span> <span class="s2">&quot;France&quot;</span><span class="p">:</span> <span class="s2">&quot;FR&quot;</span><span class="p">,</span> <span class="s2">&quot;Germany&quot;</span><span class="p">:</span> <span class="s2">&quot;GR&quot;</span><span class="p">,</span> <span class="s2">&quot;UK&quot;</span><span class="p">:</span> <span class="s2">&quot;UK&quot;</span><span class="p">,</span> <span class="s2">&quot;US&quot;</span><span class="p">:</span> <span class="s2">&quot;US&quot;</span><span class="p">}</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">n</span><span class="p">:</span> <span class="n">label_key</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">sent</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">DC_rel</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">sent_per_employee</span><span class="p">)</span>
<span class="p">}</span>


<span class="c1"># Linewidth of the edges according to number of messages</span>
<span class="n">dep_msgs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dep_msgs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">])</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">]</span>
<span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;msgs&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">widths</span><span class="p">)</span>
<span class="n">dep_msgs_df</span><span class="p">[</span><span class="s2">&quot;dep_edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dep_edges</span>
<span class="n">linewidth_edges</span> <span class="o">=</span> <span class="n">dep_msgs_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;dep_edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="nb">list</span>
<span class="p">)</span>

<span class="c1"># Layout of the graph</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">DC_rel</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span>
    <span class="n">DC_rel</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">dep_node_sizes</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">node_colors</span>
<span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span>
    <span class="n">DC_rel</span><span class="p">,</span>
    <span class="n">pos</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">font_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">font_weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">edgelist</span> <span class="ow">in</span> <span class="n">linewidth_edges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span>
        <span class="n">DC_rel</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
        <span class="n">node_size</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">dep_node_sizes</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_h</span><span class="p">,</span> <span class="n">legend_l</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/2e30aec5ae698a0867c792fe1709dd1e76e299d8a2af1f01e445ccddfb104d94.png" src="../_images/2e30aec5ae698a0867c792fe1709dd1e76e299d8a2af1f01e445ccddfb104d94.png" />
</div>
</div>
<p>Next, I will represent in a comparative graph the values of the following parameters:</p>
<ul class="simple">
<li><p><em>Degree Centrality</em>: already mentioned, this is the number of neighbors a node has, divided by the total number it could possibly have.</p></li>
<li><p><em>Betweennness Centrality</em>: is defined as the number of shortest paths in a graph that pass through a node divided by the number of shortest paths that exist between every pair of nodes in a graph. It captures bottleneck nodes in a graph, rather than highly connected nodes.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Degree centrality</span>
<span class="n">degree_centrality_DC</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">degree_centrality</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="n">dc_DC</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">degree_centrality_DC</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="s2">&quot;degree&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;node&quot;</span><span class="p">)</span>
<span class="n">dc_DC</span> <span class="o">=</span> <span class="n">dc_DC</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">dc_DC</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>  <span class="c1"># Normalize values</span>

<span class="c1"># Betweennness centrality</span>
<span class="n">betweenness_centrality_DC</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">betweenness_centrality</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="n">bc_DC</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">betweenness_centrality_DC</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="s2">&quot;betweenness&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;node&quot;</span><span class="p">)</span>
<span class="n">bc_DC</span> <span class="o">=</span> <span class="n">bc_DC</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">bc_DC</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>  <span class="c1"># Normalize values</span>

<span class="c1"># Join dataframe in the index</span>
<span class="n">centralities</span> <span class="o">=</span> <span class="n">dc_DC</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bc_DC</span><span class="p">)</span>

<span class="c1"># Sort values and get top</span>
<span class="n">centralities</span> <span class="o">=</span> <span class="n">centralities</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">top</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">centralities_top</span> <span class="o">=</span> <span class="n">centralities</span><span class="p">[:</span><span class="n">top</span><span class="p">]</span>

<span class="c1"># Melt dataframe to plot in seaborn</span>
<span class="n">centralities_melted</span> <span class="o">=</span> <span class="n">centralities_top</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">centralities_melted</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set1&quot;</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Location &amp; Department Centralities (top 10)&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Value (normalized)&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/bdffb037ee38ca99a1a39f7ba48aaecd3726b37b7d5454d157ba456c05c37ef3.png" src="../_images/bdffb037ee38ca99a1a39f7ba48aaecd3726b37b7d5454d157ba456c05c37ef3.png" />
</div>
</div>
<p>From this chart we learn that US Admin, despite not being the department that sends the most messages per employee, does have a prevalent position because it has the most connections in the network and serves as the main connecting point for the traffic in the network. So US Admin is the most influential node and the most critical one.</p>
</section>
</section>
<section id="employee-network">
<h2>Employee network<a class="headerlink" href="#employee-network" title="Link to this heading">#</a></h2>
<p>First of all, I’m going to take a look at the number of employees who sent messages or did not send them at all, combined with those who received them or did not receive them at all.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create sets</span>
<span class="n">employees_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">employees</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
<span class="n">senders_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="s2">&quot;sender&quot;</span><span class="p">])</span>
<span class="n">receivers_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="s2">&quot;receiver&quot;</span><span class="p">])</span>
<span class="n">not_senders_set</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">employee</span> <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">employees_set</span> <span class="k">if</span> <span class="n">employee</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">senders_set</span>
<span class="p">]</span>
<span class="n">not_receivers_set</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">employee</span> <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">employees_set</span> <span class="k">if</span> <span class="n">employee</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">receivers_set</span>
<span class="p">]</span>

<span class="c1"># Lists</span>
<span class="n">sender_receiver</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">employee</span>
    <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">employees_set</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">employee</span> <span class="ow">in</span> <span class="n">senders_set</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">employee</span> <span class="ow">in</span> <span class="n">receivers_set</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">sender_notreceiver</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">employee</span>
    <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">employees_set</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">employee</span> <span class="ow">in</span> <span class="n">senders_set</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">employee</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">receivers_set</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">notsender_receiver</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">employee</span>
    <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">employees_set</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">employee</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">senders_set</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">employee</span> <span class="ow">in</span> <span class="n">receivers_set</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">notsender_notreceiver</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">employee</span>
    <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">employees_set</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">employee</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">senders_set</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">employee</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">receivers_set</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Dataframe</span>
<span class="n">send_receive_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;sent&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;NO&quot;</span><span class="p">,</span> <span class="s2">&quot;YES&quot;</span><span class="p">],</span>
        <span class="s2">&quot;NO&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">notsender_notreceiver</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">sender_notreceiver</span><span class="p">)],</span>
        <span class="s2">&quot;YES&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">notsender_receiver</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">sender_receiver</span><span class="p">)],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">send_receive_df</span> <span class="o">=</span> <span class="n">send_receive_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;sent&quot;</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">send_receive_df</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">},</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.0f&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Employee did receive&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Employee did send&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Number of employees&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/cd88fc168887e357152bbf2e11e57cb4f10caf8751b8e9dabc86690337d73234.png" src="../_images/cd88fc168887e357152bbf2e11e57cb4f10caf8751b8e9dabc86690337d73234.png" />
</div>
</div>
<p>From the total number of 664 employees in the company, we learn that:</p>
<ul class="simple">
<li><p>579 employees (87%) did not send any message despite receiving them.</p></li>
<li><p>Among those who did send messages (100% - 87% = 13% &lt;–&gt; 47 + 38 = 85 from 664), 47 of them did not receive any response.</p></li>
</ul>
<p>Next I will take a look to the top 10 sender employees:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="n">senders_receivers</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;sender&quot;</span><span class="p">)[</span><span class="s2">&quot;receiver&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
    <span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;receiver&quot;</span><span class="p">:</span> <span class="s2">&quot;msgs sent&quot;</span><span class="p">})</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        msgs sent
sender           
605           459
128           266
144           221
509           216
389           196
598           187
317           184
586           180
483           169
725           137
</pre></div>
</div>
</div>
</div>
<p>And here are the top centralities in the employee network:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a multi directed graph</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">MultiDiGraph</span><span class="p">()</span>

<span class="c1"># Add nodes</span>
<span class="n">E</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">employees</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]))</span>

<span class="c1"># Add metadata for each node</span>
<span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">employee</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">employees</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
    <span class="n">E</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;department&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">employee</span><span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">]</span>
    <span class="n">E</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">employee</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span>
    <span class="n">E</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">employee</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span>

<span class="c1"># E.nodes(data=True)</span>

<span class="c1"># Add messages as edges of the gragh</span>
<span class="n">E</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span>
    <span class="p">[(</span><span class="n">message</span><span class="p">[</span><span class="s2">&quot;sender&quot;</span><span class="p">],</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;receiver&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
<span class="p">)</span>

<span class="c1"># Add metadata for each edge</span>
<span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
    <span class="n">E</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
    <span class="n">E</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;message_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;message_length&quot;</span><span class="p">]</span>

<span class="c1"># Degree centrality</span>
<span class="n">degree_centrality_E</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">degree_centrality</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
<span class="n">dc_E</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">degree_centrality_E</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="s2">&quot;degree&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
    <span class="s2">&quot;node&quot;</span>
<span class="p">)</span>
<span class="n">dc_E</span> <span class="o">=</span> <span class="n">dc_E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">dc_E</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>  <span class="c1"># Normalize values</span>

<span class="c1"># Betweennness centrality</span>
<span class="n">betweenness_centrality_E</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">betweenness_centrality</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
<span class="n">bc_E</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">betweenness_centrality_E</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="s2">&quot;betweenness&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;node&quot;</span><span class="p">)</span>
<span class="n">bc_E</span> <span class="o">=</span> <span class="n">bc_E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">bc_E</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>  <span class="c1"># Normalize values</span>

<span class="c1"># Join dataframe in the index</span>
<span class="n">centralities</span> <span class="o">=</span> <span class="n">dc_E</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bc_E</span><span class="p">)</span>

<span class="c1"># Sort values and get top</span>
<span class="n">centralities</span> <span class="o">=</span> <span class="n">centralities</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">top</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">centralities_top</span> <span class="o">=</span> <span class="n">centralities</span><span class="p">[:</span><span class="n">top</span><span class="p">]</span>

<span class="c1"># Melt dataframe to plot in seaborn</span>
<span class="n">centralities_melted</span> <span class="o">=</span> <span class="n">centralities_top</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">centralities_melted</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
    <span class="n">hue_order</span><span class="o">=</span><span class="n">centralities_melted</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">][:</span><span class="n">top</span><span class="p">],</span>
    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set1&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Employee Centralities (top 10)&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Value (normalized)&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="c1"># Legend</span>
<span class="n">h</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">identify_employee</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="n">dep</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">employees</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="p">:]</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">employees</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="p">:]</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">loc</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">dep</span>


<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">h</span><span class="p">,</span>
    <span class="p">[</span><span class="n">label</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">identify_employee</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">l</span><span class="p">],</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Employee&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/21ca3367a7fafa71b7d3953c483ae38152155266a327dcace26a793484eb0b90.png" src="../_images/21ca3367a7fafa71b7d3953c483ae38152155266a327dcace26a793484eb0b90.png" />
</div>
</div>
<p>The data indicates that the employees who send the most messages are also the ones with the most neighbors, meaning they occupy the top positions in terms of Degree Centrality. However, their position in the top ten varies when considering Betweenness Centrality, that is, their importance in the flow of information.</p>
<p>The employee 605 (from France Admin) stands out clearly for their activity. However, other employees are better connected, such as the 509 (US Admin).</p>
<p>Below is the network diagram of the neighbors of employee 605 and employee 509, the top performers in terms of Degree Centrality and Betweenness Centrality, respectively.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define subgraph plotting function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_subgraph</span><span class="p">(</span><span class="n">subgrah</span><span class="p">):</span>
    <span class="c1"># Node colors</span>
    <span class="n">departments</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">get_node_attributes</span><span class="p">(</span><span class="n">subgrah</span><span class="p">,</span> <span class="s2">&quot;department&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">node_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_key</span><span class="p">[</span><span class="n">dept</span><span class="p">]</span> <span class="k">for</span> <span class="n">dept</span> <span class="ow">in</span> <span class="n">departments</span><span class="p">]</span>
    <span class="c1"># Node sizes</span>
    <span class="n">node_sizes</span> <span class="o">=</span> <span class="mi">300</span>
    <span class="c1"># Layout</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">subgrah</span><span class="p">)</span>
    <span class="c1"># Plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span>
        <span class="n">subgrah</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">node_sizes</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">node_colors</span>
    <span class="p">)</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span>
        <span class="n">subgrah</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">font_weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span>
    <span class="p">)</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span>
        <span class="n">subgrah</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">node_sizes</span><span class="p">,</span> <span class="n">arrows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.1</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Plot employee 605 neighbors</span>
<span class="n">neighbors_605</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="mi">605</span><span class="p">))</span>
<span class="n">neighbors_605</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">605</span><span class="p">)</span>
<span class="n">E_605</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">neighbors_605</span><span class="p">)</span>
<span class="n">plot_subgraph</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">E_605</span><span class="p">))</span>

<span class="c1"># Plot employee 509 neighbors</span>
<span class="n">neighbors_509</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="mi">509</span><span class="p">))</span>
<span class="n">neighbors_509</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">509</span><span class="p">)</span>
<span class="n">E_509</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">neighbors_509</span><span class="p">)</span>
<span class="n">plot_subgraph</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">E_509</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/cde0f91acf347d5b04b53cbc60c6f677afd31ba54a87ebefa4d7838a02444021.png" src="../_images/cde0f91acf347d5b04b53cbc60c6f677afd31ba54a87ebefa4d7838a02444021.png" />
<img alt="../_images/c0937cbe546d8bc6ba128545256148bb75ab6d04bd8c420b4594f39827d3f2d7.png" src="../_images/c0937cbe546d8bc6ba128545256148bb75ab6d04bd8c420b4594f39827d3f2d7.png" />
</div>
</div>
</section>
<section id="conclusions">
<h2>Conclusions<a class="headerlink" href="#conclusions" title="Link to this heading">#</a></h2>
<p>Considering it in relative terms, that is, per employee, the Admin, Sales, and Operations departments of the US and France are the ones generating the bulk of the messages and are the most important in the flow of information within the organization. Comparatively, the rest of the departments seem less participative.</p>
<p>IT, Engineering, and especially Marketing barely communicate, and as for the countries, the UK stands out for its low activity.</p>
<p>It is striking the proportion of employees who did not send any messages (87%). And also, the fact that almost half of those who did send them, did not receive any response.</p>
<p>Regarding the most communicative employees, it is important to differentiate between the quantity of established connections and their importance in general terms of connectivity. In that sense, it was discovered that the employee who sent the most messages was surpassed by other employees who were initially less communicative when studying the relevance of those established contacts.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="hairloss.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Hairloss Analysis</p>
      </div>
    </a>
    <a class="right-next"
       href="hospital.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Reducing hospital readmissions</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-project">The project</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#company">Company</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#messages">Messages</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#between-departments">Between departments</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#between-locations">Between locations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#departments-in-locations">Departments in locations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#employee-network">Employee network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mikel Imaz, 2023-2025
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>