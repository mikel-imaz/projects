
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Municipal Indicators &#8212; datuz</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-232XT3FYCT"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-232XT3FYCT');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-232XT3FYCT');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/p-udalmap';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../_static/logo.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Movie records" href="p-films.html" />
    <link rel="prev" title="Ignatian Pilgrims" href="ignatian.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="datuz - Home"/>
    <img src="../_static/logo.svg" class="logo__image only-dark pst-js-only" alt="datuz - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Data science projects
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../projects_competition.html">Competition projects</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="book-popularity.html">What makes a good book?</a></li>
<li class="toctree-l2"><a class="reference internal" href="internet-patterns.html">Analyzing global internet patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="sleepinc.html">Helping find a better sleep</a></li>
<li class="toctree-l2"><a class="reference internal" href="hairloss.html">Hairloss Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="employee-network.html">Employee Network Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="hospital.html">Reducing hospital readmissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="hotels.html">Predicting hotel cancellations</a></li>
<li class="toctree-l2"><a class="reference internal" href="webpage.html">Was a website redesign successful?</a></li>
<li class="toctree-l2"><a class="reference internal" href="segmentation.html">Improving customer segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="abalone.html">Seafood farm process improvement</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../projects_personal.html">Personal projects</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="moles.html">Mole monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="book-translation.html">Book translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="p-antio-gpt.html">Sentiment analysis with embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="self-tracking.html">Self tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="quakes.html">Earth Quakes</a></li>
<li class="toctree-l2"><a class="reference internal" href="climate.html">Climate Change</a></li>
<li class="toctree-l2"><a class="reference internal" href="english-vocab.html">English Vocab</a></li>
<li class="toctree-l2"><a class="reference internal" href="antio.html">Bar Reviews</a></li>
<li class="toctree-l2"><a class="reference internal" href="ignatian.html">Ignatian Pilgrims</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Municipal Indicators</a></li>
<li class="toctree-l2"><a class="reference internal" href="p-films.html">Movie records</a></li>
<li class="toctree-l2"><a class="reference internal" href="ages.html">Median Ages</a></li>
<li class="toctree-l2"><a class="reference internal" href="water.html">Water Supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="olele.html">Handfan Reviews</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_fines.html">Traffic Fines</a></li>
<li class="toctree-l2"><a class="reference internal" href="urban_trees.html">Urban Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="breads.html">Bread Prices</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../writings.html">Writings</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../writings/la-importancia-de-adquirir-competencias-en-materia-de-datos.html">La importancia de adquirir competencias en materia de datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/la-ciencia-de-convertir-los-datos-en-valor.html">La ciencia de convertir los datos en valor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/que-es-la-inteligencia-artificial.html">¿Qué es la Inteligencia Artificial?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/aprendizaje-autom%C3%A1tico-vs-programaci%C3%B3n-tradicional.html">Aprendizaje automático vs programación tradicional</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/que-es-la-inteligencia-artificial-generativa.html">¿Qué es la Inteligencia Artificial Generativa?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writings/la-definicion-de-atributos-en-aprendizaje-automatico.html">La definición de atributos en aprendizaje automático</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../about-me.html">About me</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/mikel-imaz/projects" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/p-udalmap.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Municipal Indicators</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrapper">Wrapper</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-app">Demo app</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-of-rankings">Distribution of rankings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confronting-indicators">Confronting indicators</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evolution-of-indicators">Evolution of indicators</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="municipal-indicators">
<h1>Municipal Indicators<a class="headerlink" href="#municipal-indicators" title="Link to this heading">#</a></h1>
<p><img alt="" src="../_images/urretxu.jpg" /></p>
<p>Feb, 2024</p>
<blockquote>
<div><p><em>API wrapper for data mining, Data Analysis with interactive apps</em></p>
</div></blockquote>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://opendata.euskadi.eus/api-udalmap/?api=udalmap">Udalmap</a> is a information system whose purpose is to provide detailed insight into the reality of the 251 municipalities in the Basque Autonomous Community. It consists of over 200 indicators grouped into the following areas:</p>
<ul class="simple">
<li><p>Economy and competitiveness</p></li>
<li><p>Social cohesion and quality of life</p></li>
<li><p>Environment and mobility”</p></li>
</ul>
<p>Last year, an API was launched for the Udalmap database, and I came up with the idea of writing some functions to ease access to the information. These functions would constitute what is known as a wrapper, a layer that masks the lower-level code and thus simplifies the user’s program. The next logical step would be to prepare it as a module and share it with the community as an installable package on the <a class="reference external" href="https://pypi.org/">PyPI</a> site.</p>
<p>Additionally, I thought it would be good to implement a demo web app so that anyone outside the programming realm could make inquiries.</p>
<p>With the wrapper ready, I could carry out my own analysis of some municipal indicators. But, what question did I want to answer with the analysis? Honestly, I couldn’t think of what study to conduct. I was curious to know some data and plot them, but I didn’t know where to focus.</p>
<p>I finally came up with the following question: among the 251 municipalities of Euskadi, does my town stand out in any way? In which indicators does it rank among the top or bottom? And since I was going to consider the rankings, I thought it wouldn’t be a bad idea to compare the relative positions between the two towns where I live (Urretxu and Zumarraga) to find out in what areas one town excels over the other.</p>
</section>
<section id="wrapper">
<h2>Wrapper<a class="headerlink" href="#wrapper" title="Link to this heading">#</a></h2>
<p>The wrapper functions to handle Udalmap API are organized within a class that I’ve named UdalMap.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>


<span class="k">class</span><span class="w"> </span><span class="nc">UdalMap</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to get info from Udalmap API&quot;&quot;&quot;</span>

    <span class="n">URL_API</span> <span class="o">=</span> <span class="s2">&quot;https://api.euskadi.eus/udalmap/&quot;</span>
    <span class="n">REQUESTS_OK</span> <span class="o">=</span> <span class="mi">200</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;SPANISH&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_lang</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes the language&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;BASQUE&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;SPANISH&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;SPANISH&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Invalid language! SPANISH assigned&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets available groups.&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">UdalMap</span><span class="o">.</span><span class="n">URL_API</span><span class="si">}</span><span class="s2">groups?lang=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="si">}</span><span class="s2">&amp;summarized=false&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">UdalMap</span><span class="o">.</span><span class="n">REQUESTS_OK</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">groups_lst</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                <span class="n">groups_lst</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]})</span>
                <span class="c1"># groups_lst.append(group[&quot;id&quot;] + &quot;: &quot; + group[&quot;name&quot;])</span>
            <span class="k">return</span> <span class="n">groups_lst</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;requests.get(url) returns </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">subgroups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets available subgroups from a given group.&quot;&quot;&quot;</span>
        <span class="c1"># Get valid groups</span>
        <span class="n">valid_group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>
        <span class="c1"># Get subgroups</span>
        <span class="k">if</span> <span class="n">group_id</span> <span class="ow">in</span> <span class="n">valid_group_ids</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">UdalMap</span><span class="o">.</span><span class="n">URL_API</span><span class="si">}</span><span class="s2">groups/</span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2">/subgroups?lang=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="si">}</span><span class="s2">&amp;summarized=false&quot;</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">UdalMap</span><span class="o">.</span><span class="n">REQUESTS_OK</span><span class="p">:</span>
                <span class="n">subgroups</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">subgroups_lst</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">subgroup</span> <span class="ow">in</span> <span class="n">subgroups</span><span class="p">:</span>
                    <span class="n">subgroups_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">subgroup</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">subgroup</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]}</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">subgroups_lst</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;requests.get(url) returns </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&#39;group_id&#39; parameter not valid!</span>
<span class="s2">                            Should be one of these: </span><span class="si">{</span><span class="n">valid_group_ids</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">indicators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subgroup_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets available indicators from a given subgroup.&quot;&quot;&quot;</span>
        <span class="c1"># Get valid subgroups</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">UdalMap</span><span class="o">.</span><span class="n">URL_API</span><span class="si">}</span><span class="s2">subgroups?lang=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="si">}</span><span class="s2">&amp;summarized=false&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">UdalMap</span><span class="o">.</span><span class="n">REQUESTS_OK</span><span class="p">:</span>
            <span class="n">subgroups</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">valid_subgroup_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">subgroup</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">subgroup</span> <span class="ow">in</span> <span class="n">subgroups</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;requests.get(url) returns </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Get indicators</span>
        <span class="k">if</span> <span class="n">subgroup_id</span> <span class="ow">in</span> <span class="n">valid_subgroup_ids</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">UdalMap</span><span class="o">.</span><span class="n">URL_API</span><span class="si">}</span><span class="s2">subgroups/</span><span class="si">{</span><span class="n">subgroup_id</span><span class="si">}</span><span class="s2">/indicators?lang=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">UdalMap</span><span class="o">.</span><span class="n">REQUESTS_OK</span><span class="p">:</span>
                <span class="n">indicators</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">indicators_lst</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">indicators</span><span class="p">:</span>
                    <span class="n">indicators_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">indicator</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">indicator</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]}</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">indicators_lst</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;requests.get(url) returns </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;subgroup_id&#39; parameter not valid! Should be one of these: </span><span class="si">{</span><span class="n">valid_subgroup_ids</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">indicator_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indicator_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the name of an indicator id.&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">UdalMap</span><span class="o">.</span><span class="n">URL_API</span><span class="si">}</span><span class="s2">indicators/</span><span class="si">{</span><span class="n">indicator_id</span><span class="si">}</span><span class="s2">?lang=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">UdalMap</span><span class="o">.</span><span class="n">REQUESTS_OK</span><span class="p">:</span>
            <span class="n">indicator</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">indicator</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;requests.get(url) returns </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indicator_id</span><span class="p">,</span> <span class="n">entities</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets indicator data from selected entities.&quot;&quot;&quot;</span>
        <span class="c1"># Get valid indicator</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">UdalMap</span><span class="o">.</span><span class="n">URL_API</span><span class="si">}</span><span class="s2">indicators?lang=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">UdalMap</span><span class="o">.</span><span class="n">REQUESTS_OK</span><span class="p">:</span>
            <span class="n">indicators</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">valid_indicators</span> <span class="o">=</span> <span class="p">[</span><span class="n">indicator</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">indicators</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;requests.get(url) returns </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Get valid entity</span>
        <span class="n">valid_entities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">,</span> <span class="s2">&quot;regions&quot;</span><span class="p">,</span> <span class="s2">&quot;municipalities&quot;</span><span class="p">]</span>
        <span class="c1"># Get the data</span>
        <span class="k">if</span> <span class="n">entities</span> <span class="ow">in</span> <span class="n">valid_entities</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">indicator_id</span> <span class="ow">in</span> <span class="n">valid_indicators</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">UdalMap</span><span class="o">.</span><span class="n">URL_API</span><span class="si">}</span><span class="s2">indicators/</span><span class="si">{</span><span class="n">indicator_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">entities</span><span class="si">}</span><span class="s2">?lang=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">UdalMap</span><span class="o">.</span><span class="n">REQUESTS_OK</span><span class="p">:</span>
                    <span class="n">entities</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="n">entities</span><span class="p">]</span>
                    <span class="n">indicatordata_lst</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
                        <span class="n">indicatordata_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                                <span class="s2">&quot;years&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;years&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="n">indicatordata_lst</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;requests.get(url) returns </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;indicator_id&#39; parameter not valid!</span><span class="se">\n</span><span class="s2">Should be one of these: </span><span class="si">{</span><span class="n">valid_indicators</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;entities&#39; parameter not valid!</span><span class="se">\n</span><span class="s2">Should be one of these: </span><span class="si">{</span><span class="n">valid_entities</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">data_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indicator_id</span><span class="p">,</span> <span class="n">entities</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets indicator data from selected entities.</span>
<span class="sd">        Returns a pandas dataframe&quot;&quot;&quot;</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">indicator_id</span><span class="p">,</span> <span class="n">entities</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">[</span><span class="s2">&quot;years&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">names</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">data_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indicator_id</span><span class="p">,</span> <span class="n">entities</span><span class="p">,</span> <span class="n">plot_entities</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots indicator data from selected entities.</span>
<span class="sd">        Passing a list filters entities to plot&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_df</span><span class="p">(</span><span class="n">indicator_id</span><span class="p">,</span> <span class="n">entities</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
        <span class="c1"># Filter entities to plot</span>
        <span class="k">if</span> <span class="n">plot_entities</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">for</span> <span class="n">plot_entity</span> <span class="ow">in</span> <span class="n">plot_entities</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">plot_entity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plot_entity</span><span class="si">}</span><span class="s2"> not in </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">plot_entities</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># Title of the plot</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indicator_name</span><span class="p">(</span><span class="n">indicator_id</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>I instantiate an object of that class for the current project.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">gradio</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">widgets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>

<span class="c1"># Create an UdalMap class object</span>
<span class="n">udalmap</span> <span class="o">=</span> <span class="n">UdalMap</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="demo-app">
<h2>Demo app<a class="headerlink" href="#demo-app" title="Link to this heading">#</a></h2>
<p>I use the Gradio library to implement the web application with which any user can query the indicator data and plot them.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># gradio app demo</span>
<span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Blocks</span><span class="p">()</span> <span class="k">as</span> <span class="n">demo</span><span class="p">:</span>

    <span class="c1">## Components ##</span>

    <span class="c1"># Title</span>
    <span class="n">gr</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # **Udalmap API**</span>
<span class="sd">    https://opendata.euskadi.eus/apis/-/apis-open-data/</span>
<span class="sd">    </span>
<span class="sd">    **demo app** by datuz, 2024</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Components in 1st row</span>
    <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
        <span class="n">dropdown_groups</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">groups</span><span class="p">()],</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Select group:&quot;</span><span class="p">,</span>
            <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">json_groups</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Json</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">groups</span><span class="p">()],</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;groups&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Components in 2nd row</span>
    <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
        <span class="n">dropdown_subgroups</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">choices</span><span class="o">=</span><span class="p">[],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Select subgroup:&quot;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">json_subgroups</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Json</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;subgroups&quot;</span><span class="p">)</span>

    <span class="c1"># Components in 3rd row</span>
    <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
        <span class="n">dropdown_indicators</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">choices</span><span class="o">=</span><span class="p">[],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Select indicator:&quot;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">json_indicators</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Json</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;indicators&quot;</span><span class="p">)</span>

    <span class="c1"># Components in 4th row</span>
    <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
        <span class="n">radio_entity</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Radio</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">,</span> <span class="s2">&quot;regions&quot;</span><span class="p">,</span> <span class="s2">&quot;municipalities&quot;</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Select:&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;entities&quot;</span><span class="p">,</span>
            <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">textbox_indicator_name</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Selected indicator&quot;</span><span class="p">)</span>

    <span class="c1"># Components in 5th row</span>
    <span class="n">button_getdata</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Get data&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Components in 6th row</span>
    <span class="n">dataframe_data</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Dataframe</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">)</span>

    <span class="c1"># Components in 7th row</span>
    <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
        <span class="n">button_plotdata</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Plot data&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">dropdown_entity_filter</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">choices</span><span class="o">=</span><span class="p">[],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Filter:&quot;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multiselect</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="c1"># Components in 8th row</span>
    <span class="n">plot_data</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Plot&quot;</span><span class="p">)</span>

    <span class="c1">## Events ##</span>

    <span class="c1"># Group selection</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_group_select</span><span class="p">(</span><span class="n">evt</span><span class="p">:</span> <span class="n">gr</span><span class="o">.</span><span class="n">SelectData</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">subgroup</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">subgroup</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">subgroup</span> <span class="ow">in</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">subgroups</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">gr</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="n">subgroup</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">subgroup</span> <span class="ow">in</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">subgroups</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">value</span><span class="p">)],</span>
            <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">dropdown_groups</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">fn</span><span class="o">=</span><span class="n">on_group_select</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">json_subgroups</span><span class="p">,</span> <span class="n">dropdown_subgroups</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Subgroup selection</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_subgroup_select</span><span class="p">(</span><span class="n">evt</span><span class="p">:</span> <span class="n">gr</span><span class="o">.</span><span class="n">SelectData</span><span class="p">):</span>  <span class="c1"># SelectData is a subclass of EventData</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">indicator</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">indicator</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">indicators</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">gr</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="n">indicator</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">indicators</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">value</span><span class="p">)],</span>
            <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">dropdown_subgroups</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">fn</span><span class="o">=</span><span class="n">on_subgroup_select</span><span class="p">,</span>
        <span class="n">inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">json_indicators</span><span class="p">,</span> <span class="n">dropdown_indicators</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Indicator selection</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_indicator_select</span><span class="p">(</span><span class="n">indicator</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">indicator</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">indicator_name</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>

    <span class="n">dropdown_indicators</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">fn</span><span class="o">=</span><span class="n">on_indicator_select</span><span class="p">,</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">dropdown_indicators</span><span class="p">,</span>
        <span class="n">outputs</span><span class="o">=</span><span class="n">textbox_indicator_name</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Get data button</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_getdata_button</span><span class="p">(</span><span class="n">indicator</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">data_df</span><span class="p">(</span><span class="n">indicator</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">gr</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="n">button_getdata</span><span class="o">.</span><span class="n">click</span><span class="p">(</span>
        <span class="n">fn</span><span class="o">=</span><span class="n">on_getdata_button</span><span class="p">,</span>
        <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">dropdown_indicators</span><span class="p">,</span> <span class="n">radio_entity</span><span class="p">],</span>
        <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">dataframe_data</span><span class="p">,</span> <span class="n">dropdown_entity_filter</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Plot data button</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_plotdata_button</span><span class="p">(</span><span class="n">indicator</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">plot_entities</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">data_plot</span><span class="p">(</span><span class="n">indicator</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">plot_entities</span><span class="p">)</span>

    <span class="n">button_plotdata</span><span class="o">.</span><span class="n">click</span><span class="p">(</span>
        <span class="n">fn</span><span class="o">=</span><span class="n">on_plotdata_button</span><span class="p">,</span>
        <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">dropdown_indicators</span><span class="p">,</span> <span class="n">radio_entity</span><span class="p">,</span> <span class="n">dropdown_entity_filter</span><span class="p">],</span>
        <span class="n">outputs</span><span class="o">=</span><span class="n">plot_data</span><span class="p">,</span>
    <span class="p">)</span>


<span class="c1"># demo.launch()</span>
</pre></div>
</div>
</div>
</details>
</div>
<p><img alt="" src="../_images/udalmap-demo.gif" /></p>
<p>This is just a GIF animation of the demo app.</p>
<p>You can access it at <a class="reference external" href="https://huggingface.co/spaces/datuz/udalmap">Hugging Face Spaces</a>.</p>
</section>
<section id="the-data">
<h2>The data<a class="headerlink" href="#the-data" title="Link to this heading">#</a></h2>
<p>In this project, I use the wrapper to scan through the more than 200 indicators and their corresponding years. I do this only for the municipalities of Urretxu and Zumarraga, calculating for each of the obtained records the position they occupy among all the municipalities of Euskadi.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Init</span>
<span class="n">towns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Urretxu&quot;</span><span class="p">,</span> <span class="s2">&quot;Zumarraga&quot;</span><span class="p">]</span>  <span class="c1"># Towns considered</span>
<span class="n">results_lst</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Iterate through all groups</span>
<span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>
<span class="k">for</span> <span class="n">group_id</span> <span class="ow">in</span> <span class="n">group_ids</span><span class="p">:</span>

    <span class="c1"># Iterate through all subgroups</span>
    <span class="n">subgroup_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">subgroup</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">subgroup</span> <span class="ow">in</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">subgroups</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="n">group_id</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">subgroup_id</span> <span class="ow">in</span> <span class="n">subgroup_ids</span><span class="p">:</span>

        <span class="c1"># Iterate through all indicators</span>
        <span class="n">indicator_ids</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">indicator</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">indicators</span><span class="p">(</span><span class="n">subgroup_id</span><span class="o">=</span><span class="n">subgroup_id</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">indicator_id</span> <span class="ow">in</span> <span class="n">indicator_ids</span><span class="p">:</span>

            <span class="c1"># Get indicator data for all municipalities and set index to indicator id number</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">udalmap</span><span class="o">.</span><span class="n">data_df</span><span class="p">(</span>
                <span class="n">indicator_id</span><span class="o">=</span><span class="n">indicator_id</span><span class="p">,</span> <span class="n">entities</span><span class="o">=</span><span class="s2">&quot;municipalities&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="c1"># Iterate through all the columns of the df, i.e. through existing years</span>
            <span class="k">for</span> <span class="n">year</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># For each year, reset the index: created new index will serve as ranking position</span>
                <span class="n">df_year</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="c1"># Iterate through initialized towns</span>
                <span class="k">for</span> <span class="n">town</span> <span class="ow">in</span> <span class="n">towns</span><span class="p">:</span>
                    <span class="c1"># Get the record</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">df_year</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_year</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">town</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="c1"># Extract desired data from record</span>
                    <span class="n">ranking</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># index stores ranking pos</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">year</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">results_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;town&quot;</span><span class="p">:</span> <span class="n">town</span><span class="p">,</span>
                            <span class="s2">&quot;indicator&quot;</span><span class="p">:</span> <span class="n">indicator_id</span><span class="p">,</span>
                            <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
                            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                            <span class="s2">&quot;ranking&quot;</span><span class="p">:</span> <span class="n">ranking</span><span class="p">,</span>
                            <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="n">group_id</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">)</span>

<span class="c1"># Create pandas dataframe from results</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_lst</span><span class="p">)</span>

<span class="c1"># Convert &#39;year&#39; and &#39;indicator&#39; columns to integer</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;indicator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;indicator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

<span class="c1"># Sort</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape: </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape: (5632, 6)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>town</th>
      <th>indicator</th>
      <th>year</th>
      <th>value</th>
      <th>ranking</th>
      <th>group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3787</th>
      <td>Zumarraga</td>
      <td>175</td>
      <td>1991</td>
      <td>28.92</td>
      <td>199</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3962</th>
      <td>Urretxu</td>
      <td>68</td>
      <td>1991</td>
      <td>17.57</td>
      <td>95</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3963</th>
      <td>Zumarraga</td>
      <td>68</td>
      <td>1991</td>
      <td>11.03</td>
      <td>184</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3953</th>
      <td>Zumarraga</td>
      <td>70</td>
      <td>1991</td>
      <td>60.64</td>
      <td>111</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3952</th>
      <td>Urretxu</td>
      <td>70</td>
      <td>1991</td>
      <td>61.43</td>
      <td>90</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="distribution-of-rankings">
<h2>Distribution of rankings<a class="headerlink" href="#distribution-of-rankings" title="Link to this heading">#</a></h2>
<p>A histogram of the rankings obtained for each town and for each year can give us some information.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to plot histogram of rankings</span>
<span class="k">def</span><span class="w"> </span><span class="nf">histplot_rankings</span><span class="p">(</span><span class="n">town</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>

    <span class="c1"># Subset by town and year</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;town&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">town</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">),</span> <span class="p">:]</span>

    <span class="c1"># Plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ranking&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">discrete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Ranking&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">town</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Define years to show</span>
<span class="n">plot_years</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span>
    <span class="mi">4</span><span class="p">:</span>
<span class="p">]</span>  <span class="c1"># discard 1991, 1995, 1996, 1997: non consecutive and scarce data</span>

<span class="c1"># Create interactive plot</span>
<span class="n">interactive_plot</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">histplot_rankings</span><span class="p">,</span> <span class="n">town</span><span class="o">=</span><span class="n">towns</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">plot_years</span><span class="p">)</span>
<span class="n">interactive_plot</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a4cd7a54874f43e7bc1050131bcd6800", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>In the analysis, I used an interactive chart from the ipywidgets library, but since Jupyter Book does not render them, I show below two screenshots of the results.</p>
<p><img alt="" src="../_images/hist-urretxu-2022.jpg" />
<img alt="" src="../_images/hist-zumarraga-2022.jpg" /></p>
<p>According to these charts, at least regarding the year 2022, Urretxu shows a greater quantity of indicators that are close to the mean compared to Zumarraga, which appears to lean slightly more towards the corner of higher rankings (that is, among the top 50, in the chart on the left side). Does that mean that Urretxu is a more “normal” town than Zumarraga? Or does Zumarraga stand out more than Urretxu? Here, one must proceed with caution because depending on the indicator, being in the top positions doesn’t necessarily mean it’s good.</p>
</section>
<section id="confronting-indicators">
<h2>Confronting indicators<a class="headerlink" href="#confronting-indicators" title="Link to this heading">#</a></h2>
<p>I came up with the idea of comparing the indicators by plotting them on a plane, so that their position intuitively indicated the ranking that Urretxu and Zumarraga occupied in it, while also allowing to see at a glance which of the two was above the other, that is, who was winning in that specific indicator.</p>
<p>I had first to prepare the dataframe for the plotting.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reshape results to show for defined index rankings for each town</span>
<span class="n">rankings</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;indicator&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;town&quot;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;ranking&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape: </span><span class="si">{</span><span class="n">rankings</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">rankings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape: (2816, 4)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>town</th>
      <th>year</th>
      <th>group</th>
      <th>Urretxu</th>
      <th>Zumarraga</th>
    </tr>
    <tr>
      <th>indicator</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000</td>
      <td>E</td>
      <td>216.0</td>
      <td>205.0</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2005</td>
      <td>E</td>
      <td>201.0</td>
      <td>197.0</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2008</td>
      <td>E</td>
      <td>209.0</td>
      <td>198.0</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2010</td>
      <td>E</td>
      <td>211.0</td>
      <td>210.0</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2012</td>
      <td>E</td>
      <td>204.0</td>
      <td>223.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Since the position of the points according to the ranking depended on each year, I used an interactive graph that allowed me to select the year and even create an animation covering all the years.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to plot each indicator</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_indicators</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>

    <span class="c1"># Subset by year and indicator</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">rankings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rankings</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">,</span> <span class="p">:]</span>

    <span class="c1"># Plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

    <span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Zumarraga&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Urretxu&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;group&quot;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Draw a diagonal line for better visualize limit</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">260</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Indicators in </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Zumarraga&#39;s rankings&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Urretxu&#39;s rankings&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># Legend</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">h</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="s2">&quot;E: Economía y competitividad&quot;</span><span class="p">,</span>
            <span class="s2">&quot;S: Cohesión social y calidad de vida&quot;</span><span class="p">,</span>
            <span class="s2">&quot;M: Medioambiente y movilidad&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Do not show &#39;0&#39; not to confuse about meaning of ranking number 1</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">260</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">260</span><span class="p">)</span>

    <span class="c1"># Intuitively higher values better at top and right</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>

    <span class="c1"># Text to help remember while visualizing data</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="s2">&quot;Higher</span><span class="se">\n</span><span class="s2">ranking&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;ultralight&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="s2">&quot;Lower</span><span class="se">\n</span><span class="s2">ranking&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;ultralight&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">290</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;Higher</span><span class="se">\n</span><span class="s2">ranking&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;ultralight&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">290</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="s2">&quot;Lower</span><span class="se">\n</span><span class="s2">ranking&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;ultralight&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="c1"># Insert text with indicator number next to each point</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Zumarraga&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Urretxu&quot;</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Create textbox widget</span>
<span class="n">box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedIntText</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="nb">min</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="nb">max</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
    <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Year:&quot;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create animation widget</span>
<span class="n">play</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Play</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="nb">min</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="nb">max</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
    <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">interval</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Press play&quot;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Link these widgets</span>
<span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="n">play</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">))</span>

<span class="c1"># Create interactive plot</span>
<span class="n">interactive_plot</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">plot_indicators</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">box</span><span class="p">)</span>

<span class="c1"># Display both</span>
<span class="n">display</span><span class="p">(</span><span class="n">interactive_plot</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">play</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7f40960079df45b687b0dff233235974", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "630a47975552455f8197e7b6196d379a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>But Jupyter Book doesn’t render these interactivities of ipywidgets library, so I’ll place a GIF animation of them instead.</p>
<p><img alt="" src="../_images/udalmap-indicators.gif" /></p>
<p>And here’s a screenshot of 2022 for a calmer analysis.</p>
<p><img alt="" src="../_images/udalmap-indicators-scrsht.png" /></p>
<p>So, the indicators placed towards the right (for Zumarraga) and upwards (for Urretxu) indicate that respectively they enjoy a better ranking position for that specific indicator.</p>
<p>Additionally, the diagonal line separates the indicators in which each town obtains the highest positioning with respecto to the other, and the farther away the point is from this line, the greater the difference in the ranking these towns occupy in that specific indicator.</p>
<p>So let’s take a look at some of them:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_2022</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2022</span><span class="p">,</span> <span class="p">:]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">show_indicator</span><span class="p">(</span><span class="n">indicator_id</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indicator_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">udalmap</span><span class="o">.</span><span class="n">indicator_name</span><span class="p">(</span><span class="n">indicator_id</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">results_2022</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">results_2022</span><span class="p">[</span><span class="s2">&quot;indicator&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">indicator_id</span><span class="p">,</span> <span class="p">:])</span>

<span class="n">show_indicator</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>80: Edificios de viviendas familiares principales con instalación de gas por tubería (%)
           town  indicator  year  value  ranking group
4804    Urretxu         80  2022   97.1        2     S
4805  Zumarraga         80  2022   96.1        4     S
</pre></div>
</div>
</div>
</div>
<p><strong>80</strong>: Both Urretxu and Zumarraga seem to be superpowers in pipeline gas installation, as they respectively hold the second and fourth positions among all municipalities regarding this indicator.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_indicator</span><span class="p">(</span><span class="mi">67</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>67: Densidad de viviendas en suelo residencial (Viviendas/Ha.)
           town  indicator  year  value  ranking group
4265  Zumarraga         67  2022  95.00       21     S
4264    Urretxu         67  2022  92.27       22     S
</pre></div>
</div>
</div>
</div>
<p><strong>67</strong>: It’s no surprise to me that we’re up in this aspect, as it has always seemed to me that the population density is very high here.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_indicator</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30: Densidad comercial minorista (&amp;#x2030; habitantes)
           town  indicator  year  value  ranking group
2539  Zumarraga         30  2022  11.07       21     E
2538    Urretxu         30  2022  10.30       28     E
</pre></div>
</div>
</div>
</div>
<p><strong>30</strong>: As for the density of retail stores, we are also well positioned.</p>
<p>Let’s take a look at the indicators that yield opposite rankings for both towns. Which is that lonely 73 and why is it there all alone?</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_indicator</span><span class="p">(</span><span class="mi">73</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>73: Viviendas protegidas (VPO) terminadas en el último quinquenio (&amp;#x2030; habitantes)
           town  indicator  year  value  ranking group
3784    Urretxu         73  2022   3.53       20     S
3785  Zumarraga         73  2022   0.00      250     S
</pre></div>
</div>
</div>
</div>
<p><strong>73</strong>: As for the completed protected housing units in the last five years, Urretxu is doing very well while Zumarraga is doing very poorly.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_indicator</span><span class="p">(</span><span class="mi">77</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>77: Superficie residencial urbanizable (%)
           town  indicator  year  value  ranking group
4302    Urretxu         77  2022   0.00      249     S
4303  Zumarraga         77  2022  11.13      102     S
</pre></div>
</div>
</div>
</div>
<p><strong>77</strong>: It seems that there is no remaining urbanizable residential area in Urretxu, while Zumarraga occupies an intermediate position in this regard.</p>
<p>So we could continue analyzing which indicators are above average and which ones occupy lower positions, besides seeing in which indicators these two towns are distant. This information could be useful for assessing the situation of both municipalities.</p>
</section>
<section id="evolution-of-indicators">
<h2>Evolution of indicators<a class="headerlink" href="#evolution-of-indicators" title="Link to this heading">#</a></h2>
<p>The goal in this section would be to comparatively analyze, as in the previous section, the temporal evolution of certain indicators individually.</p>
<p>First I prepare the dataframe to later complete the plotting.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reshape results to show for defined index values for each town</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;indicator&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;town&quot;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;value&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape: </span><span class="si">{</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">values</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape: (2810, 4)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>town</th>
      <th>year</th>
      <th>group</th>
      <th>Urretxu</th>
      <th>Zumarraga</th>
    </tr>
    <tr>
      <th>indicator</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000</td>
      <td>E</td>
      <td>0.4</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2005</td>
      <td>E</td>
      <td>0.4</td>
      <td>0.4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2008</td>
      <td>E</td>
      <td>0.3</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2010</td>
      <td>E</td>
      <td>0.3</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2012</td>
      <td>E</td>
      <td>0.3</td>
      <td>0.2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Here I also made use an interactive graph that allowed me to select the indicator as well as the year and even create an animation covering all data-existing years.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to plot each indicator</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_indicator</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">indicator</span><span class="p">):</span>

    <span class="c1"># Subset by year and indicator</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">rankings</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">rankings</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rankings</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">indicator</span><span class="p">),</span> <span class="p">:]</span>

    <span class="c1"># Plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Zumarraga&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Urretxu&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;group&quot;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Define the base size of all the points</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># Raises error if there is no plot</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_sizes</span><span class="p">([</span><span class="mi">200</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Draw a diagonal line for better visualize limit</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">260</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Indicator: </span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">udalmap</span><span class="o">.</span><span class="n">indicator_name</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Zumarraga&#39;s rankings&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Urretxu&#39;s rankings&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># Remove legend because appears and desappears if there is or isn&#39;t a plot</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># If there is no legend it raises attribute error</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Do not show &#39;0&#39; not to confuse about meaning of ranking number 1</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">260</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">260</span><span class="p">)</span>

    <span class="c1"># Intuitively higher values better at top and right</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>

    <span class="c1"># Text to help remember while visualizing data</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="s2">&quot;Higher</span><span class="se">\n</span><span class="s2">ranking&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;ultralight&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="s2">&quot;Lower</span><span class="se">\n</span><span class="s2">ranking&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;ultralight&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">290</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;Higher</span><span class="se">\n</span><span class="s2">ranking&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;ultralight&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">290</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="s2">&quot;Lower</span><span class="se">\n</span><span class="s2">ranking&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;ultralight&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="c1"># Insert text with values next to each point</span>
    <span class="n">values_subset</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">indicator</span><span class="p">),</span> <span class="p">:</span>
    <span class="p">]</span>
    <span class="c1"># Adjust these text positions</span>
    <span class="n">pos_urr</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">pos_zum</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Zumarraga&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos_urr</span><span class="p">,</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Urretxu&quot;</span><span class="p">],</span>
            <span class="n">values_subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;Urretxu&quot;</span><span class="p">],</span>
            <span class="n">size</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Zumarraga&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos_zum</span><span class="p">,</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Urretxu&quot;</span><span class="p">],</span>
            <span class="n">values_subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;Zumarraga&quot;</span><span class="p">],</span>
            <span class="n">size</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Create textbox widget</span>
<span class="n">box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedIntText</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="nb">min</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="nb">max</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
    <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Year:&quot;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create animation widget</span>
<span class="n">play</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Play</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="nb">min</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="nb">max</span><span class="o">=</span><span class="n">plot_years</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
    <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">interval</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Press play&quot;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Link these widgets</span>
<span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">((</span><span class="n">play</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">))</span>

<span class="c1"># Create interactive plot</span>
<span class="n">indicator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;indicator&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">interactive_plot</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">plot_indicator</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">box</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="n">indicator</span><span class="p">)</span>

<span class="c1"># Display both</span>
<span class="n">display</span><span class="p">(</span><span class="n">interactive_plot</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">play</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b307622105fa47fa9d74416a87ff287d", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "3de1d74b73744e74ae2e79bd2bf278dc", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>These are some examples of indicators for which I wanted to have comprehensive visual information about the position occupied by the two towns.</p>
<p><img alt="" src="../_images/udalmap-162.gif" />
<img alt="" src="../_images/udalmap-111.gif" /></p>
<p>The total population and the population density. See that actual values are displayed on both sides of the point (Urretxu on the left, Zumarraga on the right). As indicated by these values, the point lies below the diagonal for the total population, indicating that Zumarraga has more inhabitants than Urretxu. But not for the density, with Urretxu leading Zumarraga. With respect to their position, it is observed that these towns are denser than populous, although they are quite high in the ranking in both parameters.</p>
<p><img alt="" src="../_images/udalmap-31.gif" />
<img alt="" src="../_images/udalmap-29.gif" /></p>
<p>The retail commercial area per inhabitant is decreasing in both towns, leading to a loss in ranking. It is also noticeable that in Urretxu, the number was higher, but in recent years, it tends to equalize with Zumarraga. With regards to bars and restaurants, it is evident that Urretxu has always had more establishments of this kind than Zumarraga. I thought the number of them per inhabitant was high, but I discover that in the ranking, they are mostly positioned in the average.</p>
<p><img alt="" src="../_images/udalmap-102.gif" />
<img alt="" src="../_images/udalmap-143.gif" /></p>
<p>Finally, I take a look at two parameters in the Mobility and Environment area. The vehicle fleet per inhabitant appears below average. And the area of parks and gardens per person is extremely low in Urretxu, as I expected, since with the existing urban density, there is no space for them.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>Through this project, I aimed to bring municipal indicator data to the public eye, which, despite being available, are not always easily accessible.</p>
<p>First, I prepared some functions to access the API more conveniently. Using them as a foundation, I programmed a demo application ready to be used by any citizen.</p>
<p>As for the analysis, I focused on the towns where I live, looking for indicators that made them stand out from the average and finally analyzing the temporal evolution of a handful of those indicators.</p>
<p>Personally, without a specific goal or question to answer, this project satisfied my curiosity. However, I believe that these tools can be very useful for use in specific studies where one wants to comparatively analyze the development of municipalities.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "my-venv-01"
        },
        kernelOptions: {
            name: "my-venv-01",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'my-venv-01'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ignatian.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Ignatian Pilgrims</p>
      </div>
    </a>
    <a class="right-next"
       href="p-films.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Movie records</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrapper">Wrapper</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-app">Demo app</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-of-rankings">Distribution of rankings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confronting-indicators">Confronting indicators</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evolution-of-indicators">Evolution of indicators</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mikel Imaz, 2023-2025
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>